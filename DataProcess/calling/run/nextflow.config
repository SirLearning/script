// Nextflow configuration for FastCall3 pipeline

// Process configuration
process {
    executor = 'local'
    
    // Default resource allocation
    cpus = 8       // Reduce default CPU usage
    memory = '32 GB' // Reduce default memory usage
    
    // Specific process configurations
    withName: 'prepareTaxaBamMap' {
        cpus = 4
        memory = '16 GB'
    }
    
    withName: 'fastcall3_disc' {
        cpus = 16
        memory = { 64.GB + (32.GB * task.attempt) }  // 动态内存，从64GB开始
        errorStrategy = 'retry'
        maxRetries = 3
    }
    
    withName: 'fastcall3_blib' {
        cpus = 8
        memory = { 32.GB + (8.GB * task.attempt) }  // 动态内存，从128GB开始
        errorStrategy = 'retry'
        maxRetries = 3
    }
    
    withName: 'fastcall3_scan' {
        cpus = 32
        memory = { 128.GB + (8.GB * task.attempt) }  // 动态内存，从128GB开始
        errorStrategy = 'retry'
        maxRetries = 3
    }
    
    withName: 'collect_results' {
        cpus = 8
        memory = '256 GB'
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = 128      // Update to actual system CPUs
    memory = '960 GB' // Update to actual system memory
    queueSize = 6   // Increase queue size
}

// Report configuration
report {
    enabled = true
    file = 'pipeline_info/execution_report.html'
}

timeline {
    enabled = true
    file = 'pipeline_info/execution_timeline.html'
}

trace {
    enabled = true
    file = 'pipeline_info/execution_trace.txt'
    overwrite = true  // 允许覆盖现有trace文件
}

dag {
    enabled = true
    file = 'pipeline_info/pipeline_dag.svg'
}

// Work directory cleanup
cleanup = false  // Keep work directory for debugging

// Resume configuration
resume = true

// Resource monitoring
monitor {
    enabled = true
    interval = '5min'
}
