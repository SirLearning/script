#! /bin/bash

# run samtools mpileup
# samtools version: 1.18
## $1: bam file prefix list number
## $2: reference genome
## $3: bam file directory

mapfile -t prefix < plist"$1".txt
size=${#prefix[@]}
echo "prefix loaded: ${#prefix[@]}"
for ((i=0; i<size; i++));
  do
  if [ -f "$3"/"${prefix[i]}".sub.bam ]; then
    echo "run samtools mpileup of: ${prefix[i]}.sub.bam"
    samtools mpileup --no-output-ends -B -q 30 -Q 20 -f "$2" "$3"/"${prefix[i]}".sub.bam -r 1:1-1000000 -o "${prefix[i]}".mpileup
  fi
done